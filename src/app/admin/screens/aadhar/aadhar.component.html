<main id="main" class="main">
  <div class="pagetitle">
    <h1>Document Details</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
        <li class="breadcrumb-item">Components</li>
        <li class="breadcrumb-item active">Upload</li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <div class="container">
      <h2 class="text-center">Document Data Extraction</h2>

      <form [formGroup]="uploadForm" (ngSubmit)="uploadFile()" class="p-3 border rounded bg-light">
        <div class="form-group mb-3">
          <label for="docType" class="form-label fw-bold">Select Document Type</label> <small class="text-muted">You can select one or more files</small>
          <select id="docType" formControlName="docType" class="form-select">
            <option *ngFor="let type of docTypes" [value]="type.value">{{ type.label }}</option>
          </select>
        </div>

        <div class="form-group mb-3">
          <label for="file" class="form-label text-primary">Upload File:</label>
          <input type="file" id="file" class="form-control" (change)="onFileChange($event)" />
        </div>

        <button class="btn btn-success w-100" type="submit"
          [disabled]="uploadForm.invalid || loading || uploadDisabled">
          Upload
        </button>
      </form>

      <!-- Loading Spinner -->
      <div *ngIf="loading" class="text-center mt-3">
        <p>Loading... Please wait while we extract the data.</p>
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- Display merged data in single card -->
      <div *ngIf="objectKeys(mergedResponse).length > 0" class="mt-4">
        <div class="card shadow-lg border-0 rounded-3">
          <div class="card-header">
            Student Details
          </div>
          <div class="card-body">
            <div class="row mb-2" *ngFor="let key of objectKeys(mergedResponse)">
              <div class="col-sm-4 fw-bold">{{ key | titlecase }}:</div>
              <div class="col-sm-8">
                <ng-container *ngIf="key === 'address' && mergedResponse.addressLines; else normalField">
                  <div *ngFor="let line of mergedResponse.addressLines">{{ line }}</div>
                </ng-container>
                <ng-template #normalField>
                  {{ mergedResponse[key] || 'N/A' }}
                </ng-template>
              </div>
            </div>
            <!-- âœ… Auto Fill button inside card bottom -->
            <div class="text-center mt-3">
              <button class="btn btn-danger w-100" [routerLink]="['/admin/class']">
                Auto Fill
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Error Handling -->
      <div *ngIf="errorMessage" class="alert alert-danger mt-3">{{ errorMessage }}</div>
    </div>
  </section>
</main>
